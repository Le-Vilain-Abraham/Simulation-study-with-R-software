########################################################################################################################################################## 
##############################      Code used in "Restricted mean survival time to estimate an intervention effect     ################################### 
##############################                  in a cluster randomized trial" Le Vilain--Abraham et al.               ################################### 
##########################################################################################################################################################

#_______________________________________________________ Code for proportional hazards assumption _______________________________________________________#
#______________________________________________________________ Code for permutation test _______________________________________________________________#

#--------------------------------------------------------------------------------------------------------------------------------------------------------# 
#--------------------------------------------------------- 2 - Estimation of the coverage rate ----------------------------------------------------------#  
#--------------------------------------------------------------------------------------------------------------------------------------------------------# 

# R functions 
##########################################################################################################################################################
setwd("~/your/path/to/Rfiles/") # set directory where you saved the R files with the necessary functions for the simulation
source("mp_estimation_permutation_PH.R")
source("performance_measures.R")
source("true_rmst_difference_PH.R")
source("survival_function_PH.R")

# Estimation of the coverage rate
##########################################################################################################################################################
# set the directory and the name of the file where all the estimations of the confidence intervals were saved in step 1
dataset <- read.table("~/your/path/to/analysis/name_of_your_file.txt", sep = " ", dec = ".",  header=T)

pm_estimation_permutation_PH(dataset)
